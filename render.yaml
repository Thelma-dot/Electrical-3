services:
  - type: web
    name: derelectrical-3-y99h
    env: node
    buildCommand: |
      echo "Forcing clean npm install..."
      rm -f yarn.lock
      rm -rf .yarn
      rm -f .yarnrc
      rm -f .yarnrc.yml
      rm -f package-lock.json
      rm -rf node_modules
      echo "Clearing npm cache..."
      npm cache clean --force
      echo "Installing dependencies with npm..."
      npm install --only=production --no-package-lock
      echo "Build completed successfully"
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: JWT_SECRET
        generateValue: true
      - key: DB_TYPE
        value: sqlite
      - key: DB_PATH
        value: ./electrical_management.db
      - key: FRONTEND_URL
        value: https://electrical-3.netlify.app
      - key: NPM_CONFIG_PACKAGE_MANAGER
        value: npm
      - key: YARN_DISABLE
        value: "true"
      - key: NPM_CONFIG_ENGINE_STRICT
        value: "true"
    healthCheckPath: /health
    autoDeploy: true
    branch: main
    plan: free
